
#
# cidrsubnet(prefix, newbits, netnum)
# cidrsubnet(10.0.0.0/12, 4, 3)
# 
# 10.0.0.0/16		255.255.0.0	10.0.0.0 - 10.0.255.255		10.0.0.1 - 10.0.255.254		65534	Divide					
# 10.1.0.0/16		255.255.0.0	10.1.0.0 - 10.1.255.255		10.1.0.1 - 10.1.255.254		65534	Divide	
# 10.2.0.0/16		255.255.0.0	10.2.0.0 - 10.2.255.255		10.2.0.1 - 10.2.255.254		65534	Divide		
# -> 10.3.0.0/16		255.255.0.0	10.3.0.0 - 10.3.255.255		10.3.0.1 - 10.3.255.254		65534	Divide	
# 10.4.0.0/16		255.255.0.0	10.4.0.0 - 10.4.255.255		10.4.0.1 - 10.4.255.254		65534	Divide			
# 10.5.0.0/16		255.255.0.0	10.5.0.0 - 10.5.255.255		10.5.0.1 - 10.5.255.254		65534	Divide	
# 10.6.0.0/16		255.255.0.0	10.6.0.0 - 10.6.255.255		10.6.0.1 - 10.6.255.254		65534	Divide		
# 10.7.0.0/16		255.255.0.0	10.7.0.0 - 10.7.255.255		10.7.0.1 - 10.7.255.254		65534	Divide	
# 10.8.0.0/16		255.255.0.0	10.8.0.0 - 10.8.255.255		10.8.0.1 - 10.8.255.254		65534	Divide				
# 10.9.0.0/16		255.255.0.0	10.9.0.0 - 10.9.255.255		10.9.0.1 - 10.9.255.254		65534	Divide	
# 10.10.0.0/16	255.255.0.0	10.10.0.0 - 10.10.255.255	10.10.0.1 - 10.10.255.254	65534	Divide		
# 10.11.0.0/16	255.255.0.0	10.11.0.0 - 10.11.255.255	10.11.0.1 - 10.11.255.254	65534	Divide	
# 10.12.0.0/16	255.255.0.0	10.12.0.0 - 10.12.255.255	10.12.0.1 - 10.12.255.254	65534	Divide			
# 10.13.0.0/16	255.255.0.0	10.13.0.0 - 10.13.255.255	10.13.0.1 - 10.13.255.254	65534	Divide	
# 10.14.0.0/16	255.255.0.0	10.14.0.0 - 10.14.255.255	10.14.0.1 - 10.14.255.254	65534	Divide		
# 10.15.0.0/16	255.255.0.0	10.15.0.0 - 10.15.255.255	10.15.0.1 - 10.15.255.254	65534	Divide
# 
#  
# lookup(map, key, default)
# 

locals {
  vpc_name = "${var.entity_name}_${var_env}_vpc"
  igw_name = "${var.entity_name}_${var_env}_igw"
}

resource "aws_vpc" "main" {
  # The interpolation cidrsubnet create subnet of base_cidr_block
  cidr_block = cidrsubnet(var.base_cidr_block, 4, lookup(var.region_numbers, var.region))
  tags = {
      vpc_name = local.vpc_name
  }

}

resource "aws_internet_gateway" "main" {
  vpc_id = aws_vpc.main.id
  tags = {
      vpc_igw = local.vpc_igw
  }
}
